# 🚀 Fin_RL - 强化学习投资组合策略

**项目成员**: 周逸凡、陈俊昊 (第四组)  

## 🎊 **项目成功摘要**

🏆 **重大突破**: 我们的多臂老虎机强化学习策略在挑战性股票环境中取得了显著成功！

📈 **核心成果**:
- ✅ **UCB策略**实现 **18.60%** 年化收益率
- ✅ **超越基准** **30.89个百分点** (基准-14.17% vs UCB 18.60%)  
- ✅ **10天重新平衡**频率达到最优表现 **23.09%**
- ✅ **三种策略全部盈利**，证明强化学习在金融领域的有效性

🎯 **技术验证**: 在包含大量困境股票的50只股票组合中，我们的智能策略不仅避免了损失，还实现了可观的正收益，充分展示了多臂老虎机算法的强大适应能力。

## 📊 最新Performance (2023-2024)

### 🏆 改进后的多臂老虎机策略 - 巨大成功！

| 策略类型 | 最终收益率 | 特点 | 状态 |
|---------|-----------|------|------|
| **UCB** | **🚀 18.60%** | 🥇 最佳策略 | ✅ 大幅超越基准 |
| **Epsilon-Greedy** | **10.66%** | 🥈 稳定表现 | ✅ 超越基准 |
| **Thompson Sampling** | **9.67%** | 🥉 保守策略 | ✅ 超越基准 |
| Buy-and-Hold (困境偏向) | -14.17% | 📉 基准策略 | ❌ 负收益 |

### 📈 频率敏感性分析结果

| 重新平衡频率 | UCB表现 | 策略优势 |
|-------------|---------|----------|
| **10天** | **🏆 23.09%** | 最优频率 |
| **5天** | **22.78%** | 次优选择 |
| **1天** | **21.27%** | 高频交易 |
| **30天** | **18.60%** | 低频稳健 |


## 🎯 项目概述

本项目实现了基于**多臂老虎机强化学习**的智能投资组合管理系统，并与传统投资策略进行对比分析。项目包含完整的回测框架、策略比较工具和可视化分析。

### 🌟 核心特性

- **🤖 智能策略**: 三种多臂老虎机算法 (UCB, Epsilon-Greedy, Thompson Sampling)
- **📈 风险管理**: 多因子奖励计算 + 权重分配优化
- **⚡ 频率对比**: 支持1天、5天、10天、30天重新平衡频率
- **📊 全面分析**: 50只股票投资组合 + 困境股票压力测试
- **🎨 可视化**: 策略对比图表 + 性能分析报告

## 📁 项目结构

```
Fin_RL/
├── portfolio_mab.py                    # 🚀 主要：多臂老虎机策略回测系统
├── portfolio_macd.py                   # 📈 赵huaqin的测试代码
├── test_stocks.py                      # 🧪 股票数据验证工具
├── utils/                              # 🛠️ 核心工具包
│   ├── __init__.py
│   └── multi_armed_bandit_strategy.py # 💡 多臂老虎机策略核心实现
├── StockFormer/                        # 🧠 深度学习框架 (扩展功能)
├── frequency_comparison.png            # 📊 频率对比图表
├── frequency_comparison_results.csv    # 📋 详细结果数据
└── readme.md                          # 📖 项目说明文档
```

## 🔬 策略算法详解

### 1. 多臂老虎机策略类型

#### 🎯 **UCB (Upper Confidence Bound)** - 🏆 最优策略
- **核心思想**: 平衡探索与利用，使用置信区间
- **参数优化**: c = 2.0 (适应股市不确定性)
- **适用场景**: 高波动性市场环境
- **实证表现**: 🚀 **18.60%收益率** (最佳频率下23.09%)

#### 🎲 **Epsilon-Greedy**
- **核心思想**: 固定概率随机探索
- **参数优化**: ε = 0.2 (提高探索率)
- **适用场景**: 需要平衡性能的稳定市场

#### 🎪 **Thompson Sampling**
- **核心思想**: 贝叶斯概率采样
- **参数优化**: α = β = 2.0 (保守Beta分布)
- **适用场景**: 复杂多变的市场环境

### 2. 🧠 改进的奖励计算系统

我们的奖励函数采用**多因子模型**，综合考虑：

```python
reward = 0.3 * 风险调整收益 + 0.2 * 短期动量(5天) + 
         0.1 * 中期动量(20天) + 0.2 * 趋势强度 + 
         0.2 * 相对强度(相对市场)
```

- **🛡️ 风险调整**: 夏普比率式波动率调整
- **📈 动量因子**: 多时间窗口动量捕捉
- **📊 趋势分析**: 移动平均交叉信号
- **🔄 相对强度**: 相对于市场的超额收益

### 3. 🎛️ 风险管理机制

- **权重限制**: 单股票最大权重15%
- **多样化约束**: 强制投资前80%股票
- **学习期延长**: 50天学习期（vs原来20天）
- **动态调整**: 基于策略特性的权重优化

## 📈 投资组合配置

### 🎯 50只股票组合 (挑战性配置)

| 板块 | 股票数量 | 代表股票 | 特点 |
|------|---------|----------|------|
| **困境股票** | 6只 | PTON, PLUG, GOEV, BYND, RIVN, LCID | 高风险测试 |
| **传统零售** | 8只 | WMT, COST, HD, TGT | 消费板块 |
| **能源股** | 8只 | XOM, CVX, BP, COP | 周期性行业 |
| **银行** | 6只 | JPM, BAC, WFC, C | 金融板块 |
| **房地产** | 6只 | SPG, EXR, PLD, AMT | REITs + 房地产 |
| **制造业** | 6只 | GE, F, GM, CAT, BA | 传统制造 |
| **媒体电信** | 5只 | DIS, VZ, T, CMCSA | 传统媒体 |
| **航空** | 5只 | DAL, UAL, AAL, LUV | 周期性运输 |

> 💡 **设计理念**: 包含大量困境股票，测试策略在困难环境下的表现

## 🚀 使用指南

### 1. 快速开始

```bash
# 验证股票数据
python test_stocks.py

# 🚀 复现成功结果 - 运行完整策略对比 (推荐)
python portfolio_mab.py | tee strategy_results.txt

# 运行传统MACD策略
python portfolio_macd.py
```

> 💡 **预期结果**: 运行后您将看到UCB策略实现约18.60%收益率，大幅超越基准策略！

### 2. 高级用法

```bash
# 运行单一频率测试
python -c "
from portfolio_mab import run_single_frequency_test
run_single_frequency_test(freq=5)  # 5天重新平衡
"

# 生成详细报告
python portfolio_mab.py &> detailed_results_$(date +%Y%m%d).txt
```

### 3. 参数调优

在 `portfolio_mab.py` 中修改策略参数：

```python
strategy_params = {
    'ucb': {'c': 2.0},              # 调整UCB探索参数
    'epsilon_greedy': {'epsilon': 0.2},  # 调整探索率
    'thompson': {'alpha': 2.0, 'beta': 2.0}  # 调整Beta分布
}
```

## 📊 输出文件说明

运行后自动生成：

| 文件名 | 内容 | 用途 |
|-------|------|------|
| `frequency_comparison.png` | 📈 4频率对比图表 | 可视化分析 |
| `frequency_comparison_results.csv` | 📋 详细数据 | 数据分析 |
| `results.txt` | 📝 运行日志 | 调试和分析 |

## 🎨 可视化示例

### 频率对比图表包含：
1. **📈 策略收益率对比** (按重新平衡频率)
2. **📊 最佳策略识别** (每个频率下的最优选择)
3. **🔄 MAB策略平均表现** vs Buy-and-Hold
4. **📋 详细统计表格** (收益率、波动率等)




### TODO
- [ ] 🧠 集成StockFormer深度学习预测
- [ ] 📊 添加更多技术指标 (RSI, MACD, Bollinger Bands)
- [ ] 🎯 实现动态参数调优